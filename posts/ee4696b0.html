<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>动漫巡礼地标地图</title>
    <!-- 引入百度地图API -->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=1XjLLEhZhQNUzd93EjU5nOGQ&s=1"></script>
    <style>
        #mapContainer { width: 100%; height: 600px; }
    </style>
</head>
<body>
    <div id="mapContainer"></div>
    <script>
        // 初始化百度地图
        function initBaiduMap() {
            var map = new BMap.Map("mapContainer");
            // 设置地图选项
            map.enableScrollWheelZoom(true); // 启用滚轮缩放
            map.addControl(new BMap.NavigationControl()); // 添加导航控件
            map.addControl(new BMap.ScaleControl()); // 添加比例尺控件
            // 设置地图的初始中心点和缩放级别
            map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);
            return map;
        }
        // 从API获取数据
        function fetchLandmarks(subjectID) {
            Promise.all([
                fetch(`https://api.anitabi.cn/bangumi/${subjectID}/lite`),
                fetch(`https://api.anitabi.cn/bangumi/${subjectID}/points/detail?haveImage=true`)
            ])
            .then(responses => Promise.all(responses.map(r => r.json())))
            .then(([bangumiData, landmarksData]) => {
                const map = initBaiduMap();
                if (Array.isArray(landmarksData)) {
                    landmarksData.forEach(point => {
                        addMarkerToMap(point, map, bangumiData);
                    });
                } else {
                    console.log('No landmarks found for the provided subject ID.');
                }
                if (bangumiData && bangumiData.geo && bangumiData.zoom) {
                    map.centerAndZoom(new BMap.Point(bangumiData.geo[1], bangumiData.geo[0]), bangumiData.zoom);
                }
            })
            .catch(error => console.error('Error fetching landmarks:', error));
        }
        // 在百度地图上添加标记
        function addMarkerToMap(point, map, bangumiData) {
            if (!point.geo || !point.geo[0] || !point.geo[1]) {
                console.error('Invalid geo coordinates:', point);
                return;
            }
            var p = new BMap.Point(point.geo[1], point.geo[0]); // 注意坐标顺序
            var marker = new BMap.Marker(p);  // 创建标注
            map.addOverlay(marker);              // 将标注添加到地图中  
            // 创建信息窗口
            var infoWindowContent = `
                <b>${bangumiData ? bangumiData.cn : '未知番剧'}: ${point.cn || '未知地标'}</b><br>
                ${point.name || '未知名称'}<br>
                <img src="${point.image ? point.image.replace('?plan=h160', '?plan=h360') : '无图片'}" width="100" height="auto"><br>
                Origin: ${point.origin || '未知来源'}<br>
                <a href="${point.originURL || '#'}" target="_blank">${point.originURL || '无链接'}</a>
            `;  // 创建信息窗口内容
            var infoWindow = new BMap.InfoWindow(infoWindowContent);  // 创建信息窗口
            marker.addEventListener("click", function(){ // 添加点击事件
                this.openInfoWindow(infoWindow, map, p); // 打开信息窗口
            });
        }
        // 使用示例ID调用函数
        fetchLandmarks(115908); // 要查询的Bangumi作品ID?《《《《《《《《《《《《=============================================================================
        //如何获取所有作品id进行展示
    </script>
</body>
</html>